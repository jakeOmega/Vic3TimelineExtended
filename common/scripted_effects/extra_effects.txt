space_elevator_construction = {
	if = {
		limit = {
			NOT = { has_variable = space_elevator_progress_var }
		}
		set_variable = {
			name = space_elevator_progress_var
			value = 0
		}
	}
	if = {
		limit = {
			has_variable = space_elevator_progress_var
			any_scope_building = {
				is_building_type = building_space_elevator_construction_site
				building_has_goods_shortage = no
			}
		}
		change_variable = {
			name = space_elevator_progress_var
			add = {
				value = b:building_space_elevator_construction_site.occupancy
				divide = 12
				if = {
					limit = {
						any_scope_building = { has_active_production_method = pm_space_elevator_construction_slow }
					}
					multiply = 0.25
				}
				else_if = {
					limit = {
						any_scope_building = { has_active_production_method = pm_space_elevator_construction_medium }
					}
					multiply = 0.5
				}
				else_if = {
					limit = {
						any_scope_building = { has_active_production_method = pm_space_elevator_construction_fast }
					}
					multiply = 1
				}
				else = {
					multiply = 0
				}
				multiply = 1000
				ceiling = yes
				divide = 1000
			}
		}
	}
	if = {
		limit = {
			var:space_elevator_progress_var >= 1
		}
		set_variable = {
			name = space_elevator_progress_var
			value = 0
		}
		remove_building = building_space_elevator_construction_site
		if = {
			limit = { has_building = building_space_elevator }
			switch = {
                trigger = b:building_space_elevator.level
				1 = {create_building = { building = building_space_elevator level = 2}}
				2 = {create_building = { building = building_space_elevator level = 3}}
				3 = {create_building = { building = building_space_elevator level = 4}}
				4 = {create_building = { building = building_space_elevator level = 5}}
				5 = {create_building = { building = building_space_elevator level = 6}}
				6 = {create_building = { building = building_space_elevator level = 7}}
				7 = {create_building = { building = building_space_elevator level = 8}}
				8 = {create_building = { building = building_space_elevator level = 9}}
				9 = {create_building = { building = building_space_elevator level = 10}}
				10 = {create_building = { building = building_space_elevator level = 11}}
				11 = {create_building = { building = building_space_elevator level = 12}}
				12 = {create_building = { building = building_space_elevator level = 13}}
				13 = {create_building = { building = building_space_elevator level = 14}}
				14 = {create_building = { building = building_space_elevator level = 15}}
				15 = {create_building = { building = building_space_elevator level = 16}}
				16 = {create_building = { building = building_space_elevator level = 17}}
				17 = {create_building = { building = building_space_elevator level = 18}}
				18 = {create_building = { building = building_space_elevator level = 19}}
				19 = {create_building = { building = building_space_elevator level = 20}}
			}
		}
		else = {
			create_building = {
				building = building_space_elevator
				level = 1
			}
		}
	}
}

thought_control_loyalists_update = {
	if = {
		limit = {
			owner = {
				has_law = law_type:law_ministry_of_thought_control
			}
		}

		if = {
			limit = {
				owner = {
					institution_investment_level = {
						institution = institution_ministry_of_thought_control
						value = 1
					}
				}
			}
			add_loyalists = {
				value = {
					value = ministry_of_thought_control_monthly_effect
					multiply = 1
				}
			}
		}
		else_if = {
			limit = {
				owner = {
					institution_investment_level = {
						institution = institution_ministry_of_thought_control
						value = 2
					}
				}
			}
			add_loyalists = {
				value = {
					value = ministry_of_thought_control_monthly_effect
					multiply = 2
				}
			}
		}
		else_if = {
			limit = {
				owner = {
					institution_investment_level = {
						institution = institution_ministry_of_thought_control
						value = 3
					}
				}
			}
			add_loyalists = {
				value = {
					value = ministry_of_thought_control_monthly_effect
					multiply = 3
				}
			}
		}
		else_if = {
			limit = {
				owner = {
					institution_investment_level = {
						institution = institution_ministry_of_thought_control
						value = 4
					}
				}
			}
			add_loyalists = {
				value = {
					value = ministry_of_thought_control_monthly_effect
					multiply = 4
				}
			}
		}
		else_if = {
			limit = {
				owner = {
					institution_investment_level = {
						institution = institution_ministry_of_thought_control
						value = 5
					}
				}
			}
			add_loyalists = {
				value = {
					value = ministry_of_thought_control_monthly_effect
					multiply = 5
				}
			}
		}
	}
}

expand_building_private_construction = {
	if = {
		limit = { is_building_type = building_textile_mills }
		state = { start_privately_funded_building_construction = building_textile_mills }
	}
	else_if = {
		limit = { is_building_type = building_furniture_manufacturies }
		state = { start_privately_funded_building_construction = building_furniture_manufacturies }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants }
		state = { start_privately_funded_building_construction = building_synthetics_plants }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_silk }
		state = { start_privately_funded_building_construction = building_synthetics_plants_silk }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_oil }
		state = { start_privately_funded_building_construction = building_synthetics_plants_oil }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_rubber }
		state = { start_privately_funded_building_construction = building_synthetics_plants_rubber }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_opium }
		state = { start_privately_funded_building_construction = building_synthetics_plants_opium }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_coal }
		state = { start_privately_funded_building_construction = building_synthetics_plants_coal }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_wood }
		state = { start_privately_funded_building_construction = building_synthetics_plants_wood }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_sugar }
		state = { start_privately_funded_building_construction = building_synthetics_plants_sugar }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_meat }
		state = { start_privately_funded_building_construction = building_synthetics_plants_meat }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_fruit }
		state = { start_privately_funded_building_construction = building_synthetics_plants_fruit }
	}
	else_if = {
		limit = { is_building_type = building_synthetics_plants_drinks }
		state = { start_privately_funded_building_construction = building_synthetics_plants_drinks }
	}
	else_if = {
		limit = { is_building_type = building_chemical_plants }
		state = { start_privately_funded_building_construction = building_chemical_plants }
	}
	else_if = {
		limit = { is_building_type = building_explosives_factory }
		state = { start_privately_funded_building_construction = building_explosives_factory }
	}
	else_if = {
		limit = { is_building_type = building_motor_industry }
		state = { start_privately_funded_building_construction = building_motor_industry }
	}
	else_if = {
		limit = { is_building_type = building_car_industry }
		state = { start_privately_funded_building_construction = building_car_industry }
	}
	else_if = {
		limit = { is_building_type = building_electrics_industry }
		state = { start_privately_funded_building_construction = building_electrics_industry }
	}
	else_if = {
		limit = { is_building_type = building_electrics_industry_radio }
		state = { start_privately_funded_building_construction = building_electrics_industry_radio }
	}
	else_if = {
		limit = { is_building_type = building_electrics_industry_appliances }
		state = { start_privately_funded_building_construction = building_electrics_industry_appliances }
	}
	if = {
		limit = { is_building_type = building_power_plant }
		state = { start_privately_funded_building_construction = building_power_plant }
	}
	else_if = {
		limit = { is_building_type = building_war_machine_industry }
		state = { start_privately_funded_building_construction = building_war_machine_industry }
	}
	else_if = {
		limit = { is_building_type = building_aeroplanes_industry }
		state = { start_privately_funded_building_construction = building_aeroplanes_industry }
	}
	else_if = {
		limit = { is_building_type = building_software_industry }
		state = { start_privately_funded_building_construction = building_software_industry }
	}
	else_if = {
		limit = { is_building_type = building_network_infrastructure }
		state = { start_privately_funded_building_construction = building_network_infrastructure }
	}
	else_if = {
		limit = { is_building_type = building_nuclear_plant }
		state = { start_privately_funded_building_construction = building_nuclear_plant }
	}
	else_if = {
		limit = { is_building_type = building_fusion_plant }
		state = { start_privately_funded_building_construction = building_fusion_plant }
	}
	else_if = {
		limit = { is_building_type = building_renewable_energy_plant }
		state = { start_privately_funded_building_construction = building_renewable_energy_plant }
	}
	else_if = {
		limit = { is_building_type = building_electronic_components_and_semiconductor_industry }
		state = { start_privately_funded_building_construction = building_electronic_components_and_semiconductor_industry }
	}
	else_if = {
		limit = { is_building_type = building_robotics_industry }
		state = { start_privately_funded_building_construction = building_robotics_industry }
	}
	else_if = {
		limit = { is_building_type = building_advanced_material_fabricator }
		state = { start_privately_funded_building_construction = building_advanced_material_fabricator }
	}
	else_if = {
		limit = { is_building_type = building_launch_facility }
		state = { start_privately_funded_building_construction = building_launch_facility }
	}
	else_if = {
		limit = { is_building_type = building_space_mine }
		state = { start_privately_funded_building_construction = building_space_mine }
	}
	else_if = {
		limit = { is_building_type = building_steel_mills }
		state = { start_privately_funded_building_construction = building_steel_mills }
	}
	else_if = {
		limit = { is_building_type = building_food_industry }
		state = { start_privately_funded_building_construction = building_food_industry }
	}
	else_if = {
		limit = { is_building_type = building_glassworks }
		state = { start_privately_funded_building_construction = building_glassworks }
	}
	else_if = {
		limit = { is_building_type = building_tooling_workshops }
		state = { start_privately_funded_building_construction = building_tooling_workshops }
	}
	else_if = {
		limit = { is_building_type = building_paper_mills }
		state = { start_privately_funded_building_construction = building_paper_mills }
	}
	else_if = {
		limit = { is_building_type = building_shipyards }
		state = { start_privately_funded_building_construction = building_shipyards }
	}
	else_if = {
		limit = { is_building_type = building_military_shipyards }
		state = { start_privately_funded_building_construction = building_military_shipyards }
	}
	else_if = {
		limit = { is_building_type = building_arms_industry }
		state = { start_privately_funded_building_construction = building_arms_industry }
	}
	else_if = {
		limit = { is_building_type = building_artillery_foundries }
		state = { start_privately_funded_building_construction = building_artillery_foundries }
	}
	else_if = {
		limit = { is_building_type = building_munition_plants }
		state = { start_privately_funded_building_construction = building_munition_plants }
	}
	else_if = {
		limit = { is_building_type = building_arts_academy }
		state = { start_privately_funded_building_construction = building_arts_academy }
	}
	else_if = {
		limit = { is_building_type = building_railway }
		state = { start_privately_funded_building_construction = building_railway }
	}
	else_if = {
		limit = { is_building_type = building_construction_sector_mod }
		state = { start_privately_funded_building_construction = building_construction_sector_mod }
	}
}

expand_random_building = {
	random_scope_building = {
		limit = {
			weekly_profit > 0
			occupancy > 0.9
			OR = {
				is_building_type = building_textile_mills
				is_building_type = building_furniture_manufacturies
				is_building_type = building_synthetics_plants
				is_building_type = building_synthetics_plants_silk
				is_building_type = building_synthetics_plants_oil
				is_building_type = building_synthetics_plants_rubber
				is_building_type = building_synthetics_plants_opium
				is_building_type = building_synthetics_plants_coal
				is_building_type = building_synthetics_plants_wood
				is_building_type = building_synthetics_plants_sugar
				is_building_type = building_synthetics_plants_meat
				is_building_type = building_synthetics_plants_fruit
				is_building_type = building_synthetics_plants_drinks
				is_building_type = building_chemical_plants
				is_building_type = building_explosives_factory
				is_building_type = building_motor_industry
				is_building_type = building_car_industry
				is_building_type = building_electrics_industry
				is_building_type = building_electrics_industry_radio
				is_building_type = building_electrics_industry_appliances
				is_building_type = building_power_plant
				is_building_type = building_war_machine_industry
				is_building_type = building_aeroplanes_industry
				is_building_type = building_software_industry
				is_building_type = building_network_infrastructure
				is_building_type = building_nuclear_plant
				is_building_type = building_fusion_plant
				is_building_type = building_renewable_energy_plant
				is_building_type = building_electronic_components_and_semiconductor_industry
				is_building_type = building_robotics_industry
				is_building_type = building_advanced_material_fabricator
				is_building_type = building_launch_facility
				is_building_type = building_space_mine
				is_building_type = building_steel_mills
				is_building_type = building_food_industry
				is_building_type = building_glassworks
				is_building_type = building_tooling_workshops
				is_building_type = building_paper_mills
				is_building_type = building_shipyards
				is_building_type = building_military_shipyards
				is_building_type = building_arms_industry
				is_building_type = building_artillery_foundries
				is_building_type = building_munition_plants
				is_building_type = building_arts_academy
				is_building_type = building_railway
				is_building_type = building_construction_sector_mod
			}
		}
		while = {
			count = expand_levels
			expand_building_private_construction = yes
		}
	}
}

queue_more_private_investment = {
	if = {
		limit = {
			needed_private_levels > 0
			investment_pool > max_investment_pool_before_on_action
			has_wasted_construction = yes
		}
		while = {
			count = needed_private_levels
			expand_random_building = yes
		}
	}
}

recalculate_culture_acceptance_cost = {
	remove_modifier = accepted_cultures_cost
	add_modifier = {
		name = accepted_cultures_cost
		multiplier = {
			value = total_cultural_acceptance_cost_script_value
			divide = 100
		}
	}
}


accept_culture = {
	if = {
		limit = {
			is_target_in_variable_list = {
				name = unaccepted_cultures
				target = $CULTURE$
			}
		}
		remove_list_variable = {
			name = unaccepted_cultures
			target = $CULTURE$
		}
	}
	else = {
		add_to_variable_list = {
			name = accepted_cultures
			target = $CULTURE$
		}
	}
}

unaccept_culture = {
	if = {
		limit = {
			is_target_in_variable_list = {
				name = accepted_cultures
				target = $CULTURE$
			}
		}
		remove_list_variable = {
			name = accepted_cultures
			target = $CULTURE$
		}
	}
	else = {
		add_to_variable_list = {
			name = unaccepted_cultures
			target = $CULTURE$
		}
	}
}

change_acceptance = {
	if = {
		limit = {
			$CULTURE$ = {
				culture_is_discriminated_in = ROOT
			}
		}
		accept_culture = {
			CULTURE = $CULTURE$
		}
	}
	else = {
		unaccept_culture = {
			CULTURE = $CULTURE$
		}
	}
}