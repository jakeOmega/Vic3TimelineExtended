# =================================================================
# Financial Conditions
# Represents periods of financial boom and bust, influenced by Financial Regulation laws.
# Relocalized from "Harvest Conditions" to represent market cycles.
# =================================================================

# NEGATIVE FINANCIAL CONDITIONS

financial_panic = {
	# A state is only vulnerable if it has a developed economy and stock market.
	trigger = {
		any_scope_state = {
			is_incorporated = yes
			owner = { has_technology_researched = stock_exchange }
			OR = {
				is_world_market_hub = yes
				is_capital = yes
				any_scope_building = { is_building_type = building_company_headquarter }
				pop_type_percent_state = { target = pop_type:capitalists value > 0.01 }
			}
		}
	}

	# A state can't be in a panic and a boom at the same time.
	incompatible_with = speculative_frenzy
	incompatible_with = bull_market

	# Financial panics are contagious and can spread to neighboring states.
	range = { integer_range = { min = 1 max = 8 } }
	
	# Panics are long-lasting events, representing a deep recession.
	duration = { fixed_range = { min = 26 max = 208 } } # 0.5 to 4 years

	# The actual gameplay effects of a financial panic.
	modifier = {
		building_employment_capitalists_mult = -0.1
		building_urban_center_throughput_add = -0.1
		building_group_bg_manufacturing_throughput_add = -0.01
		state_construction_mult = -0.01
		# Pops whose lives get worse during a panic become radicalized much faster.
		state_radicals_and_loyalists_from_sol_change_mult = 0.15
	}

	# Intensity determines the severity of the modifier's effects. Panics can be very severe.
	intensity = { fixed_range = { min = 2 max = 5 } }

	# This block determines the probability of the event firing in an eligible state.
	chance = {
		value = 0.001
		 # National cycle stress → multiply chance
		if = { limit = { owner = { var:finance_cycle_value < 10 } } multiply = 4.0 }   # Panic
		else_if = { limit = { owner = { var:finance_cycle_value >= 10 var:finance_cycle_value < 25 } } multiply = 2.0 } # Downturn
		else_if = { limit = { owner = { var:finance_cycle_value >= 40 } } multiply = 0 }

		# Bubble can pop
		if = { limit = { any_scope_state = { owner = { var:bubble_pressure >= 65 } } } multiply = 2.0 }
	}

	# Visuals
	color = { 180 30 30 }
	icon = "gfx/interface/icons/law_icons/command_economy.dds" # Placeholder
}

market_downturn = {
	trigger = {
		any_scope_state = {
			is_incorporated = yes
			owner = { has_technology_researched = stock_exchange }
			OR = {
				is_world_market_hub = yes
				is_capital = yes
				any_scope_building = { is_building_type = building_company_headquarter }
				pop_type_percent_state = { target = pop_type:capitalists value > 0.01 }
			}
		}
	}
	incompatible_with = speculative_frenzy
	incompatible_with = bull_market
	incompatible_with = financial_panic

	range = { integer_range = { min = 0 max = 8 } }
	duration = { fixed_range = { min = 26 max = 104 } } # 0.5 to 2 years

	modifier = {
		state_capitalists_investment_pool_efficiency_mult = -0.15
		building_urban_center_throughput_add = -0.1
	}

	intensity = { fixed_range = { min = 1 max = 3 } }

	chance = {
		value = 0.01
			if = { limit = { owner = { var:finance_cycle_value < 25 } } multiply = 3.0 }  # Downturn
			else_if = { limit = { owner = { var:finance_cycle_value >= 25 var:finance_cycle_value < 40 } } multiply = 1.8 } # Stagnation
			else_if = { limit = { owner = { var:finance_cycle_value >= 60 } } multiply = 0 }
	}

	color = { 200 100 100 }
	icon = "gfx/interface/icons/law_icons/interventionism.dds" # Placeholder
}

# POSITIVE FINANCIAL CONDITIONS

bull_market = {
	trigger = {
		any_scope_state = {
			is_incorporated = yes
			owner = { has_technology_researched = stock_exchange }
			OR = {
				is_world_market_hub = yes
				is_capital = yes
				any_scope_building = { is_building_type = building_company_headquarter }
				pop_type_percent_state = { target = pop_type:capitalists value > 0.01 }
			}
		}
	}
	incompatible_with = financial_panic
	incompatible_with = market_downturn
	incompatible_with = speculative_frenzy

	range = { integer_range = { min = 0 max = 8 } }
	duration = { fixed_range = { min = 26 max = 156 } } # 0.5 to 3 years

	modifier = {
		state_capitalists_investment_pool_efficiency_mult = 0.05
		building_urban_center_throughput_add = 0.1
	}

	intensity = { fixed_range = { min = 1 max = 2 } }

	chance = {
		value = 0.01 # Rare at first
		if = { limit = { any_scope_state = { owner = { var:finance_cycle_value >= 40 var:finance_cycle_value < 60 } } } multiply = 2.0 } # Boom
		else_if = { limit = { any_scope_state = { owner = { var:finance_cycle_value >= 60 var:finance_cycle_value < 80 } } } multiply = 1.5 } # Overheating
		else_if = { limit = { any_scope_state = { owner = { var:finance_cycle_value < 40 } } } multiply = 0 }
	}

	color = { 100 200 100 }
	icon = "gfx/interface/icons/law_icons/free_trade.dds" # Placeholder
}